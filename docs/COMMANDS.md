# Cartha CLI Command Reference

Complete documentation for all Cartha CLI commands and their arguments.

## Table of Contents

- [cartha register](#cartha-register)
- [cartha pair status](#cartha-pair-status)
- [cartha prove-lock](#cartha-prove-lock)
- [cartha extend-lock](#cartha-extend-lock)
- [cartha claim-deposit](#cartha-claim-deposit)
- [cartha version](#cartha-version)
- [Environment Variables](#environment-variables)

---

## cartha register

Register a hotkey on the Cartha subnet and obtain your pair password.

### Usage

```bash
cartha register [OPTIONS]
```

### Options

| Option | Type | Required | Description |
| --- | --- | --- | --- |
| `--wallet-name`, `--wallet.name` | string | Yes | Coldkey wallet name |
| `--wallet-hotkey`, `--wallet.hotkey` | string | Yes | Hotkey name within the wallet |
| `--network` | string | No | Bittensor network name (default: `finney`) |
| `--netuid` | integer | No | Subnet netuid (default: `35`) |
| `--pow` | flag | No | Use PoW registration instead of burned registration |
| `--cuda` | flag | No | Enable CUDA for PoW registration |

### Examples

```bash
# Register with burned TAO (default)
cartha register \
  --wallet-name cold \
  --wallet-hotkey hot \
  --network finney \
  --netuid 35

# Register with PoW
cartha register \
  --wallet-name cold \
  --wallet-hotkey hot \
  --pow \
  --cuda
```

### What It Does

1. Loads your wallet and validates hotkey ownership
2. Checks if the hotkey is already registered
3. Performs registration (burned TAO or PoW)
4. Retrieves the assigned UID from the metagraph
5. Generates a pair password from the verifier
6. Displays the UID and pair password

**Important:** Keep your pair password secure. It's required for all verifier interactions and exposure could allow others to steal your locked USDC rewards.

---

## cartha pair status

Check the status of your miner pair on the verifier.

### Usage

```bash
cartha pair status [OPTIONS]
```

### Options

| Option | Type | Required | Description |
| --- | --- | --- | --- |
| `--wallet-name`, `--wallet.name` | string | Yes | Coldkey wallet name |
| `--wallet-hotkey`, `--wallet.hotkey` | string | Yes | Hotkey name within the wallet |
| `--hotkey` | string | Yes | Hotkey SS58 address |
| `--slot` | integer | Yes | Subnet UID assigned to the miner |
| `--network` | string | No | Bittensor network name (default: `finney`) |
| `--netuid` | integer | No | Subnet netuid (default: `35`) |
| `--json` | flag | No | Emit the raw JSON response |

### Examples

```bash
# Check pair status
cartha pair status \
  --wallet-name cold \
  --wallet-hotkey hot \
  --hotkey bt1abc123... \
  --slot 123

# Get JSON output
cartha pair status \
  --wallet-name cold \
  --wallet-hotkey hot \
  --hotkey bt1abc123... \
  --slot 123 \
  --json
```

### What It Does

1. Loads your wallet and validates hotkey ownership
2. Signs a challenge message with your hotkey
3. Sends the signed challenge to the verifier
4. Retrieves pair metadata including:
   - Verification status
   - Locked USDC amounts
   - Password issuance timestamp
   - Registration status
5. If no password exists, prompts to generate one

---

## cartha prove-lock

Submit a lock proof for your USDC deposit to the verifier.

### Usage

```bash
cartha prove-lock [OPTIONS]
```

### Options

| Option | Type | Required | Description |
| --- | --- | --- | --- |
| `--payload-file` | path | No | Path to JSON file generated by `build_lock_proof.py`. If provided, all other parameters are loaded from this file. |
| `--chain` | integer | Yes* | EVM chain ID for the vault transaction |
| `--vault` | string | Yes* | Vault contract address |
| `--tx` | string | Yes* | Transaction hash for the LockCreated event |
| `--amount` | string | Yes* | Lock amount in USDC (e.g. 250.5). Auto-detects if normalized USDC or base units (>1e9) |
| `--hotkey` | string | Yes* | Bittensor hotkey SS58 address |
| `--slot` | integer | Yes* | Subnet UID assigned to the miner |
| `--miner-evm` | string | Yes* | EVM address that signed the LockProof payload |
| `--pwd` | string | Yes* | Pair password used when signing the LockProof payload |
| `--signature` | string | No | Hex EIP-712 signature. If not provided, CLI will prompt for signing |
| `--timestamp` | integer | No | Unix timestamp (seconds) used when signing the LockProof. Required when using signature from `build_lock_proof.py` |
| `--json` | flag | No | Emit the verifier response as JSON |

*Required unless `--payload-file` is provided

### Examples

```bash
# Submit with all arguments (will prompt for signature if not provided)
cartha prove-lock \
  --chain 8453 \
  --vault 0x1234567890123456789012345678901234567890 \
  --tx 0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890 \
  --amount 250.5 \
  --hotkey bt1abc123... \
  --slot 123 \
  --miner-evm 0x9876543210987654321098765432109876543210 \
  --pwd 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

# Use payload file (from build_lock_proof.py)
cartha prove-lock --payload-file testnet/outputs/lock_proof_payload.json

# JSON output mode
cartha prove-lock \
  --chain 8453 \
  --vault 0x1234... \
  --tx 0xabcd... \
  --amount 250 \
  --hotkey bt1... \
  --slot 123 \
  --miner-evm 0x9876... \
  --pwd 0x1234... \
  --json
```

### Signing Options

If `--signature` is not provided, the CLI will prompt you to choose:

1. **Local Signing** (recommended for convenience)
   - Uses `CARTHA_EVM_PK` environment variable if set
   - Otherwise prompts for private key securely (hidden input)
   - Automatically generates EIP-712 signature
   - Derives and confirms EVM address

2. **External Signing** (MetaMask, hardware wallets, etc.)
   - Generates EIP-712 message files in `cartha_eip712_outputs/`
   - Provides instructions for signing with external tools
   - Prompts for signature after external signing

See [EIP-712 Signing Guide](EIP712_SIGNING.md) for detailed instructions.

### What It Does

1. Collects all required fields (chain, vault, tx, amount, hotkey, slot, password)
2. Prompts for EIP-712 signature (or generates locally)
3. Validates all inputs immediately after entry
4. Shows a summary table with all lock proof details
5. Confirms before submission
6. Submits the lock proof to the verifier
7. Displays success message with amount details

---

## cartha extend-lock

Extend your lock period by submitting a new lock proof with updated lock days.

### Usage

```bash
cartha extend-lock [OPTIONS]
```

### Options

| Option | Type | Required | Description |
| --- | --- | --- | --- |
| `--wallet-name`, `--wallet.name` | string | Yes | Coldkey wallet name |
| `--wallet-hotkey`, `--wallet.hotkey` | string | Yes | Hotkey name within the wallet |
| `--slot` | integer | No | Subnet UID assigned to the miner. If not provided, will auto-fetch from network |
| `--auto-fetch-uid` | flag | No | Automatically fetch UID from Bittensor network (default: enabled) |
| `--network` | string | No | Bittensor network name (default: `finney`) |
| `--netuid` | integer | No | Subnet netuid (default: `35`) |
| `--lock-days` | integer | No | New lock period in days (min 7, max 365). This will REPLACE your current lock days, not extend them |
| `--json` | flag | No | Emit the verifier response as JSON |

### Examples

```bash
# Extend lock with interactive prompts
cartha extend-lock \
  --wallet-name cold \
  --wallet-hotkey hot

# Extend lock with specific lock days
cartha extend-lock \
  --wallet-name cold \
  --wallet-hotkey hot \
  --lock-days 365

# JSON output mode
cartha extend-lock \
  --wallet-name cold \
  --wallet-hotkey hot \
  --lock-days 180 \
  --json
```

### Requirements

- You must have an existing lock proof (use `cartha pair status` to check)
- You must have access to the EVM private key used for the original lock
- You must sign a new EIP-712 signature with the updated lock days

### Important Notes

⚠️ **This REPLACES your lock days, not extends them**

When you use `extend-lock`, the new lock period is calculated from the **current time**, not from your original expiration date. This means:

- If your lock expires in 30 days and you extend with 60 days, your new expiration will be 60 days from now (not 90 days from now)
- The `proof_at` timestamp is recalculated to the current time
- This effectively replaces your lock period rather than adding to it

### What It Does

1. Authenticates with Bittensor signature to prove hotkey ownership
2. Fetches your current lock proof details from the verifier
3. Prompts for new lock days (or uses `--lock-days` if provided)
4. Collects your EVM private key for signing (or uses `CARTHA_EVM_PK` environment variable)
5. Generates a new EIP-712 signature with:
   - Same transaction hash, vault, chain, amount from your original lock
   - New `lock_days` value
   - Current timestamp (recalculating `proof_at`)
6. Shows a summary table with all details
7. Confirms before submission
8. Submits the lock proof to the verifier
9. The miner is automatically added to the upcoming epoch list

### When to Use

- Your lock is expiring soon and you want to continue receiving emissions
- You want to change your lock period (e.g., from 30 days to 365 days)
- You want to ensure you're included in the upcoming epoch

### Environment Variables

- `CARTHA_EVM_PK`: Set this to avoid prompting for your EVM private key each time

```bash
export CARTHA_EVM_PK="0x..."
```

---

## cartha claim-deposit

Alias for `prove-lock` designed for deposit-first workflows.

### Usage

```bash
cartha claim-deposit [OPTIONS]
```

### Options

Same as `cartha prove-lock`. See [cartha prove-lock](#cartha-prove-lock) for complete documentation.

### When to Use

Use `claim-deposit` when you've already made your USDC deposit and want to claim it by submitting a lock proof. It's functionally identical to `prove-lock` but provides a more intuitive command name for this workflow.

---

## cartha version

Display the CLI version information.

### Usage

```bash
cartha version
```

### Output

Displays the current version of the Cartha CLI.

---

## Environment Variables

The following environment variables can be set to configure the CLI:

| Variable | Description | Default |
| --- | --- | --- |
| `CARTHA_VERIFIER_URL` | Verifier endpoint URL | `https://cartha-verifier-826542474079.us-central1.run.app` |
| `CARTHA_NETWORK` | Bittensor network name | `finney` |
| `CARTHA_NETUID` | Subnet netuid | `35` |
| `CARTHA_EVM_PK` | EVM private key for local signing (optional) | - |
| `BITTENSOR_WALLET_PATH` | Override wallet path if keys are not in the default location | - |

### Setting Environment Variables

```bash
# Linux/macOS
export CARTHA_VERIFIER_URL="https://cartha-verifier-826542474079.us-central1.run.app"
export CARTHA_NETWORK="finney"
export CARTHA_NETUID="35"

# Windows (PowerShell)
$env:CARTHA_VERIFIER_URL="https://cartha-verifier-826542474079.us-central1.run.app"
$env:CARTHA_NETWORK="finney"
$env:CARTHA_NETUID="35"

# Using .env file (recommended)
# Create a .env file in your project root:
CARTHA_VERIFIER_URL=https://cartha-verifier-826542474079.us-central1.run.app
CARTHA_NETWORK=finney
CARTHA_NETUID=35
```

---

## Common Workflows

### First-Time Setup

1. **Register your hotkey:**
   ```bash
   cartha register --wallet-name cold --wallet-hotkey hot
   ```
   Save the displayed pair password securely.

2. **Check your pair status:**
   ```bash
   cartha pair status \
     --wallet-name cold \
     --wallet-hotkey hot \
     --hotkey bt1... \
     --slot 123
   ```

### Submitting a Lock Proof

1. **Make your USDC deposit** to the vault contract on-chain

2. **Submit the lock proof:**
   ```bash
   cartha prove-lock \
     --chain 8453 \
     --vault 0xVAULT \
     --tx 0xTXHASH \
     --amount 250 \
     --hotkey bt1... \
     --slot 123 \
     --miner-evm 0xEVMADDR \
     --pwd 0xPAIRPWD
   ```

3. The CLI will guide you through signing (local or external)

### Extending Your Lock Period

1. **Check your current lock status:**
   ```bash
   cartha pair status \
     --wallet-name cold \
     --wallet-hotkey hot
   ```

2. **Extend your lock:**
   ```bash
   cartha extend-lock \
     --wallet-name cold \
     --wallet-hotkey hot \
     --lock-days 365
   ```

3. The CLI will:
   - Authenticate with Bittensor signature
   - Fetch your current lock proof details
   - Prompt for EVM private key (or use `CARTHA_EVM_PK`)
   - Generate new signature with updated lock days
   - Submit to verifier

### Using Payload Files

For testnet or automated workflows:

1. **Generate payload file:**
   ```bash
   python testnet/build_lock_proof.py
   ```

2. **Submit using payload file:**
   ```bash
   cartha prove-lock --payload-file testnet/outputs/lock_proof_payload.json
   ```

---

## Troubleshooting

### Wallet Not Found

Ensure your Bittensor wallet files exist in the default location or set `BITTENSOR_WALLET_PATH`:

```bash
export BITTENSOR_WALLET_PATH="/path/to/your/wallets"
```

### Pair Password Not Found

If `pair status` shows no password, the CLI will prompt to generate one. Make sure your hotkey is registered and you have network access to the verifier.

### Signature Generation Fails

- Ensure `eth-account` is installed: `uv sync`
- For local signing, verify `CARTHA_EVM_PK` is set correctly
- For external signing, follow the instructions in the generated files

### Verifier Connection Errors

- Check `CARTHA_VERIFIER_URL` is set correctly
- Verify network connectivity
- Check verifier status: `curl $CARTHA_VERIFIER_URL/health`

---

For more help, see [Feedback & Support](FEEDBACK.md).

